---
title: "MVA-Final Project"
author: "Leaf Dataset Group"
date: "11/13/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
# install.packages('comprehenr')
# install.packages('dplyr')
library(comprehenr)
library(KernSmooth)
library(ellipse)
library(MVA)
library(CCA) 
library(dplyr)
# comment
 
full_df = read.csv('https://raw.githubusercontent.com/iniadewumi/MVA-Dataset-Exploration/master/MVA/datasets/leaf/leaf.csv')

k = c("1" = "Quercus suber", "2" = "Salix atrocinerea", "3" = "Populus nigra", "4" = "Alnus sp", 
      "5" = "Quercus robur", "6" = "Crataegus monogyna", "7" = "Ilex aquifolium", "8" = "Nerium oleander",
      "9" = "Betula pubescens", "10" = "Tilia tomentosa", "11" = "Acer palmaturu", "12" = "Celtis sp", 
      "13" = "Corylus avellana", "14" = "Castanea sativa", "15" = "Populus alba", "16" = "Acer negundo", 
      "17" = "Taxus bacatta", "18" = "Papaver sp", "19" = "Polypodium vulgare", "20" = "Pinus sp", 
      "21" = "Fraxinus sp", "22" = "Primula vulgaris", "23" = "Erodium sp", "24" = "Bougainvillea sp", 
      "25" = "Arisarum vulgare", "26" = "Euonymus japonicus", "27" = "Ilex perado ssp azorica", 
      "28" = "Magnolia soulangeana", "29" = "Buxus sempervirens", "30" = "Urtica dioica", 
      "31" = "Podocarpus sp", "32" = "Acca sellowiana", "33" = "Hydrangea sp", "34" = "Pseudosasa japonica", 
      "35" = "Magnolia grandiflora", "36" = "Geranium sp", "37" = "Aesculus californica", 
      "38" = "Chelidonium majus", "39" = "Schinus terebinthifolius", "40" = "Fragaria vesca")

cols = c('Class', 'Specimen_Number', 'Eccentricity', 'Aspect_Ratio', 'Elongation', 'Solidity', 
         'Stochastic_Convexity', 'Isoperimetric_Factor', 'Maximal_Indentation_Depth', 'Lobedness', 
         'Average_Intensity', 'Average_Contrast', 'Smoothness', 'Third_Moment', 'Uniformity', 
         'Entropy')


colnames(full_df) = cols

agg_df = aggregate(full_df, list(full_df$Class), mean)


for (i in 1:nrow(full_df)) {
  name = as.character(k[full_df[i, "Class"]])
  full_df[i, "Sci_Name"] = name
}


for (i in 1:nrow(agg_df)) {
  name = as.character(k[agg_df[i, "Class"]])
  agg_df[i, "Sci_Name"] = name
}

rownames(agg_df) = agg_df$Sci_Name

agg_df = agg_df[-c(1,2,3,18) ]




# full_df = as.data.frame(full_df)
# leaf_df = full_df[-c(1,2,3,18) ]
leaf_df = agg_df
# unique(full_df$Class)
# unique(cols)
# unique("Class")
```


##MISSING DATA CHECK
*We will check for NA values, and see if there are any zero values, which might suggest that the value might have been missing value. *
*The we will check for negative values as well, which might affect analysis in the future*
*Next we conduct a basic summary on the data-frame.*

```{r}
cat("Count of NAs:", sum(is.na(leaf_df)), "\n")
cat("Count of 0 values", sum(leaf_df[leaf_df==0]), "\n")
cat("Cosunt of Negative values:", sum(leaf_df[leaf_df<0]), "\n")

cat("\n\n")
summary(leaf_df)
```

##OUTLIERS CHECK
Since we had multiple columns, it was difficult plotting the BV plot with the right variables, so, we decided to do a column by column check on our dataset. We got the  Mean and Standard Deviation of each column, then we checked each row for 3 standard deviations from the mean, and they all fit within 3 standard deviations



But when we used interquartile range, outliers were found. 

```{r}


for(name in colnames(leaf_df)){
  col = leaf_df[, name]
  m = mean(col)
  sdv = sd(col)
  
  for (val in leaf_df[name]){
    if (val>m+sdv*3 || val<m-sdv*3){
      print(val)
    }
  }
}



outliers <- function(x) {

  Q1 <- quantile(x, probs=.25)
  Q3 <- quantile(x, probs=.75)
  iqr = Q3-Q1

 upper_limit = Q3 + (iqr*1.5)
 lower_limit = Q1 - (iqr*1.5)
 
 cat("\n\n", "Up", upper_limit)
 cat("\nLow", lower_limit)

 x > upper_limit | x < lower_limit
}

remove_outliers <- function(df, cols = names(df)) {
  for (col in cols) {
    # df <- df[!outliers(df[[col]]),]
    cat("\n\n", col)
    outliers(df[[col]])
  }
  df
}

remove_outliers(full_df, as.vector(colnames(leaf_df)))

```

##DATASET CORRELATION AND COVARIANCE 
```{r}

leaf_df.cor = cor(leaf_df)
leaf_df.cov = cov(leaf_df)

cat("Covariance Matrix\n\n")
leaf_df.cov

cat("\n\nCorrelation Matrix\n\n")
leaf_df.cor

```

##FINDINGS FROM CORRELATION AND COVARIANCE ANALYSIS

```{r}

```

##DENSITY ANALYSIS

```{r}


#Use list comprehension to calculate the bw for each columns in the dataset
bw = to_vec(for(col in colnames(leaf_df)) dpik(as.matrix(leaf_df[col])))


#Calculate the density for each column
leaf_df.mdens <- bkde2D(leaf_df, bandwidth = bw)



# plot(leaf_df)
# contour(x = leaf_df.mdens$x1, y = leaf_df.mdens$x2, z = leaf_df.mdens$fhat, add = TRUE)


for( col in colnames(leaf_df)){
   
  bw = dpik(as.matrix(leaf_df[col]))
  
  den = density(as.matrix(leaf_df[col]), bw=bw, kernel = "gaussian")
  plot(den, main=col)
}


```

##NOTE: Multidimension Density Plot is unreadable. 



##PCA Analysis
```{r}

leaf_df.pca_cor = princomp(leaf_df, cor = TRUE)
summary(leaf_df.pca_cor, loadings=T)

```


##MDS Analysis
```{r}
leaf.dist = dist(leaf_df)

leaf_df.mds = cmdscale(leaf.dist, eig = TRUE)
leaf_df.mds

```


##Hierarchical Clustering
```{r}

hcs <- hclust(leaf.dist, "single")
plot(hcs, main = "Single Linkage HC Dendrogram")

```


```{r}
print("hello")
```

